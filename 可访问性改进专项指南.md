# â™¿ TodoList å¯è®¿é—®æ€§æ”¹è¿›ä¸“é¡¹æŒ‡å—

**ç›®æ ‡**: ç¬¦åˆ WCAG 2.1 AA æ ‡å‡†,æ”¯æŒæ‰€æœ‰ç”¨æˆ·ç¾¤ä½“

**å½“å‰è¯„åˆ†**: 6.5/10 âš ï¸
**ç›®æ ‡è¯„åˆ†**: 9.0/10 âœ…

---

## ğŸ“Š WCAG 2.1 AA åˆè§„æ€§æ£€æŸ¥

### å½“å‰çŠ¶å†µ

| æŒ‡æ ‡ | å½“å‰çŠ¶æ€ | WCAGè¦æ±‚ | åˆè§„æ€§ |
|-----|---------|---------|--------|
| é¢œè‰²å¯¹æ¯”åº¦ | æœªéªŒè¯ | â‰¥4.5:1 | âš ï¸ æœªçŸ¥ |
| å±å¹•é˜…è¯»å™¨ | éƒ¨åˆ†æ”¯æŒ | å®Œæ•´è¯­ä¹‰ | âŒ ä¸åˆè§„ |
| å­—ä½“ç¼©æ”¾ | å›ºå®šå¤§å° | æ”¯æŒ200% | âŒ ä¸åˆè§„ |
| é”®ç›˜å¯¼èˆª | æœ‰é™æ”¯æŒ | å®Œå…¨æ”¯æŒ | âš ï¸ éƒ¨åˆ†åˆè§„ |
| è§¦æ‘¸åŒºåŸŸ | éƒ¨åˆ†è¿‡å° | â‰¥44x44px | âš ï¸ éƒ¨åˆ†åˆè§„ |
| ç„¦ç‚¹æŒ‡ç¤ºå™¨ | é»˜è®¤æ ·å¼ | æ¸…æ™°å¯è§ | âš ï¸ å¯æ”¹è¿› |

---

## ğŸ¯ æ”¹è¿›ä¼˜å…ˆçº§

### Phase 1: å…³é”®åˆè§„æ€§ (2å‘¨)

#### 1.1 é¢œè‰²å¯¹æ¯”åº¦éªŒè¯å’Œä¿®å¤ âš ï¸ P0

**WCAG æ ‡å‡†**:
- æ­£å¸¸æ–‡å­— (< 18px): **4.5:1**
- å¤§æ–‡å­— (â‰¥ 18px æˆ– â‰¥ 14px åŠ ç²—): **3:1**
- å›¾å½¢å…ƒç´ å’Œ UI ç»„ä»¶: **3:1**

**å®æ–½æ­¥éª¤**:

**ç¬¬1æ­¥: åˆ›å»ºå¯¹æ¯”åº¦æ£€æŸ¥å·¥å…·**

```dart
// lib/src/core/accessibility/contrast_checker.dart

import 'dart:math';
import 'package:flutter/material.dart';

class ContrastChecker {
  /// æ£€æŸ¥é¢œè‰²å¯¹æ¯”åº¦æ˜¯å¦ç¬¦åˆ WCAG 2.1 AA æ ‡å‡†
  ///
  /// [foreground] å‰æ™¯è‰² (æ–‡å­—/å›¾æ ‡)
  /// [background] èƒŒæ™¯è‰²
  /// [isLargeText] æ˜¯å¦ä¸ºå¤§æ–‡å­— (â‰¥18px æˆ– â‰¥14px bold)
  /// è¿”å›: true è¡¨ç¤ºç¬¦åˆæ ‡å‡†
  static bool meetsWCAG_AA(
    Color foreground,
    Color background, {
    bool isLargeText = false,
  }) {
    final ratio = calculateContrast(foreground, background);
    final threshold = isLargeText ? 3.0 : 4.5;
    return ratio >= threshold;
  }

  /// æ£€æŸ¥æ˜¯å¦ç¬¦åˆ WCAG 2.1 AAA æ ‡å‡† (æ›´ä¸¥æ ¼)
  static bool meetsWCAG_AAA(
    Color foreground,
    Color background, {
    bool isLargeText = false,
  }) {
    final ratio = calculateContrast(foreground, background);
    final threshold = isLargeText ? 4.5 : 7.0;
    return ratio >= threshold;
  }

  /// è®¡ç®—å¯¹æ¯”åº¦æ¯”ç‡
  ///
  /// è¿”å›: å¯¹æ¯”åº¦æ¯”ç‡ (1.0 - 21.0)
  static double calculateContrast(Color color1, Color color2) {
    final luminance1 = _relativeLuminance(color1);
    final luminance2 = _relativeLuminance(color2);

    final lighter = max(luminance1, luminance2);
    final darker = min(luminance1, luminance2);

    return (lighter + 0.05) / (darker + 0.05);
  }

  /// è®¡ç®—ç›¸å¯¹äº®åº¦
  ///
  /// ä½¿ç”¨ sRGB è‰²å½©ç©ºé—´çš„ç›¸å¯¹äº®åº¦å…¬å¼
  /// å‚è€ƒ: https://www.w3.org/WAI/GL/wiki/Relative_luminance
  static double _relativeLuminance(Color color) {
    final r = _channelLuminance(color.red);
    final g = _channelLuminance(color.green);
    final b = _channelLuminance(color.blue);

    // åŠ æƒæ±‚å’Œ (äººçœ¼å¯¹ç»¿è‰²æœ€æ•æ„Ÿ)
    return 0.2126 * r + 0.7152 * g + 0.0722 * b;
  }

  /// è®¡ç®—å•é€šé“äº®åº¦
  static double _channelLuminance(int channelValue) {
    final c = channelValue / 255.0;

    // gamma æ ¡æ­£
    if (c <= 0.03928) {
      return c / 12.92;
    } else {
      return pow((c + 0.055) / 1.055, 2.4).toDouble();
    }
  }

  /// è·å–å¯¹æ¯”åº¦è¯„çº§
  static ContrastRating getRating(double ratio, {bool isLargeText = false}) {
    if (isLargeText) {
      if (ratio >= 7.0) return ContrastRating.aaaPass;
      if (ratio >= 4.5) return ContrastRating.aaPass;
      if (ratio >= 3.0) return ContrastRating.aaLargePass;
      return ContrastRating.fail;
    } else {
      if (ratio >= 7.0) return ContrastRating.aaaPass;
      if (ratio >= 4.5) return ContrastRating.aaPass;
      return ContrastRating.fail;
    }
  }

  /// å»ºè®®æ”¹è¿›é¢œè‰²ä»¥è¾¾åˆ°ç›®æ ‡å¯¹æ¯”åº¦
  static Color suggestForegroundColor(
    Color background,
    double targetRatio, {
    bool preferDark = true,
  }) {
    // ç®€åŒ–å®ç°: è¿”å›é»‘è‰²æˆ–ç™½è‰²
    final contrastWithBlack = calculateContrast(Colors.black, background);
    final contrastWithWhite = calculateContrast(Colors.white, background);

    if (preferDark && contrastWithBlack >= targetRatio) {
      return Colors.black;
    } else if (contrastWithWhite >= targetRatio) {
      return Colors.white;
    } else {
      // è¿”å›å¯¹æ¯”åº¦æ›´é«˜çš„é¢œè‰²
      return contrastWithBlack > contrastWithWhite
          ? Colors.black
          : Colors.white;
    }
  }
}

enum ContrastRating {
  fail,           // ä¸ç¬¦åˆä»»ä½•æ ‡å‡†
  aaLargePass,    // ä»…ç¬¦åˆ AA å¤§æ–‡å­—æ ‡å‡†
  aaPass,         // ç¬¦åˆ AA æ ‡å‡†
  aaaPass,        // ç¬¦åˆ AAA æ ‡å‡†
}

extension ContrastRatingExtension on ContrastRating {
  String get description {
    switch (this) {
      case ContrastRating.fail:
        return 'ä¸ç¬¦åˆ WCAG æ ‡å‡†';
      case ContrastRating.aaLargePass:
        return 'WCAG AA (ä»…å¤§æ–‡å­—)';
      case ContrastRating.aaPass:
        return 'WCAG AA âœ“';
      case ContrastRating.aaaPass:
        return 'WCAG AAA âœ“âœ“';
    }
  }

  Color get statusColor {
    switch (this) {
      case ContrastRating.fail:
        return Colors.red;
      case ContrastRating.aaLargePass:
        return Colors.orange;
      case ContrastRating.aaPass:
        return Colors.green;
      case ContrastRating.aaaPass:
        return Colors.blue;
    }
  }
}
```

**ç¬¬2æ­¥: åœ¨ä¸»é¢˜ä¸­éªŒè¯æ‰€æœ‰é…è‰²**

```dart
// lib/src/app/theme/app_theme.dart

import 'package:todolist/src/core/accessibility/contrast_checker.dart';

class AppTheme {
  static ThemeData light([...]) {
    final theme = FlexThemeData.light(...);

    // å¼€å‘æ¨¡å¼ä¸‹éªŒè¯å¯¹æ¯”åº¦
    assert(() {
      _validateColorContrast(theme.colorScheme);
      return true;
    }());

    return theme;
  }

  /// éªŒè¯ä¸»é¢˜é…è‰²å¯¹æ¯”åº¦
  static void _validateColorContrast(ColorScheme scheme) {
    final checks = [
      // åŸºç¡€è¡¨é¢
      _ContrastCheck(
        name: 'Surface text',
        foreground: scheme.onSurface,
        background: scheme.surface,
        isLargeText: false,
      ),
      _ContrastCheck(
        name: 'Surface variant text',
        foreground: scheme.onSurfaceVariant,
        background: scheme.surface,
        isLargeText: false,
      ),

      // ä¸»è‰²
      _ContrastCheck(
        name: 'Primary button',
        foreground: scheme.onPrimary,
        background: scheme.primary,
        isLargeText: false,
      ),
      _ContrastCheck(
        name: 'Primary container',
        foreground: scheme.onPrimaryContainer,
        background: scheme.primaryContainer,
        isLargeText: false,
      ),

      // é”™è¯¯è‰²
      _ContrastCheck(
        name: 'Error',
        foreground: scheme.onError,
        background: scheme.error,
        isLargeText: false,
      ),

      // å¡ç‰‡
      _ContrastCheck(
        name: 'Card text',
        foreground: scheme.onSurface,
        background: scheme.surfaceContainerLow,
        isLargeText: false,
      ),
    ];

    final failures = <String>[];

    for (final check in checks) {
      final ratio = ContrastChecker.calculateContrast(
        check.foreground,
        check.background,
      );

      if (!ContrastChecker.meetsWCAG_AA(
        check.foreground,
        check.background,
        isLargeText: check.isLargeText,
      )) {
        failures.add(
          '${check.name}: ${ratio.toStringAsFixed(2)}:1 '
          '(éœ€è¦ ${check.isLargeText ? "3.0" : "4.5"}:1)',
        );
      }
    }

    if (failures.isNotEmpty) {
      debugPrint('âš ï¸ WCAG å¯¹æ¯”åº¦æ£€æŸ¥å¤±è´¥:');
      for (final failure in failures) {
        debugPrint('  - $failure');
      }

      throw FlutterError(
        'ä¸»é¢˜é…è‰²ä¸ç¬¦åˆ WCAG 2.1 AA æ ‡å‡†:\n${failures.join("\n")}',
      );
    }

    debugPrint('âœ… WCAG å¯¹æ¯”åº¦æ£€æŸ¥é€šè¿‡');
  }
}

class _ContrastCheck {
  final String name;
  final Color foreground;
  final Color background;
  final bool isLargeText;

  _ContrastCheck({
    required this.name,
    required this.foreground,
    required this.background,
    required this.isLargeText,
  });
}
```

**ç¬¬3æ­¥: ä¿®å¤ä¸ç¬¦åˆæ ‡å‡†çš„é¢œè‰²**

```dart
// æ£€æŸ¥å½“å‰ä½¿ç”¨çš„é¢œè‰²
final problematicColors = [
  // æ¬¡è¦æ–‡å­—è‰²
  Color(0xFF757575), // åœ¨ç™½è‰²èƒŒæ™¯ä¸Šå¯¹æ¯”åº¦çº¦ 4.6:1 âœ“ (åˆšå¥½åˆæ ¼)

  // è¾¹æ¡†è‰²
  Color(0xFFE0E0E0), // åœ¨ç™½è‰²èƒŒæ™¯ä¸Šå¯¹æ¯”åº¦çº¦ 1.3:1 âŒ (ä¸åˆæ ¼,ä½†è¾¹æ¡†ä¸å¼ºåˆ¶è¦æ±‚)

  // ä¼˜å…ˆçº§ç‚¹
  Colors.blue.shade600,   // éœ€è¦éªŒè¯
  Colors.orange.shade600, // éœ€è¦éªŒè¯
  Colors.red.shade700,    // éœ€è¦éªŒè¯
];

// å¦‚æœä¸åˆæ ¼,è°ƒæ•´é¢œè‰²
// æ–¹æ³•1: åŠ æ·±é¢œè‰²
final adjustedColor = Color.lerp(originalColor, Colors.black, 0.2);

// æ–¹æ³•2: ä½¿ç”¨å·¥å…·å»ºè®®çš„é¢œè‰²
final suggestedColor = ContrastChecker.suggestForegroundColor(
  backgroundColor,
  4.5, // ç›®æ ‡å¯¹æ¯”åº¦
  preferDark: true,
);
```

**å·¥ä½œé‡**: 8 å°æ—¶

---

#### 1.2 å±å¹•é˜…è¯»å™¨å®Œæ•´æ”¯æŒ âš ï¸ P0

**ç›®æ ‡**: æ‰€æœ‰äº¤äº’å…ƒç´ éƒ½æœ‰æ¸…æ™°çš„è¯­ä¹‰ä¿¡æ¯

**å®æ–½æ­¥éª¤**:

**ç¬¬1æ­¥: ä¸ºä»»åŠ¡å¡ç‰‡æ·»åŠ å®Œæ•´è¯­ä¹‰**

```dart
// lib/src/features/home/presentation/widgets/accessible_task_card.dart

class AccessibleTaskCard extends StatelessWidget {
  final Task task;

  @override
  Widget build(BuildContext context) {
    return Semantics(
      // ä¸»æ ‡ç­¾: å®Œæ•´æè¿°ä»»åŠ¡ä¿¡æ¯
      label: _buildSemanticLabel(),

      // æç¤º: å‘Šè¯‰ç”¨æˆ·å¯ä»¥åšä»€ä¹ˆ
      hint: _buildSemanticHint(),

      // è¯­ä¹‰è§’è‰²
      button: true,
      enabled: true,

      // ç‚¹å‡»åŠ¨ä½œ
      onTap: () => _editTask(),

      // é•¿æŒ‰åŠ¨ä½œ
      onLongPress: () => _showContextMenu(),

      child: Card(
        child: InkWell(
          onTap: _editTask,
          onLongPress: _showContextMenu,
          child: Padding(
            padding: EdgeInsets.all(16),
            child: Row(
              children: [
                // ä¼˜å…ˆçº§æŒ‡ç¤ºå™¨ - æ’é™¤åœ¨è¯­ä¹‰æ ‘å¤– (å·²åœ¨ label ä¸­æè¿°)
                ExcludeSemantics(
                  child: _PriorityDot(priority: task.priority),
                ),

                SizedBox(width: 12),

                // ä»»åŠ¡å†…å®¹
                Expanded(
                  child: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      // æ ‡é¢˜ - åˆå¹¶åˆ°çˆ¶çº§ Semantics
                      Text(task.title),

                      if (task.notes != null) ...[
                        SizedBox(height: 4),
                        // å¤‡æ³¨ - è‡ªåŠ¨åŒ…å«åœ¨è¯­ä¹‰ä¸­
                        Text(
                          task.notes!,
                          style: TextStyle(color: Colors.grey[600]),
                        ),
                      ],

                      if (task.dueAt != null) ...[
                        SizedBox(height: 8),
                        // æˆªæ­¢æ—¶é—´ - æ·»åŠ è¯­ä¹‰æ ‡ç­¾
                        Semantics(
                          label: _formatDueAtForScreenReader(task.dueAt!),
                          excludeSemantics: true,
                          child: Row(
                            children: [
                              Icon(Icons.timer_outlined, size: 16),
                              SizedBox(width: 4),
                              Text(_formatDueAt(task.dueAt!)),
                            ],
                          ),
                        ),
                      ],
                    ],
                  ),
                ),

                // å®Œæˆå¤é€‰æ¡† - ç‹¬ç«‹è¯­ä¹‰
                Semantics(
                  label: task.isCompleted ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ',
                  hint: task.isCompleted ? 'åŒå‡»æ ‡è®°ä¸ºæœªå®Œæˆ' : 'åŒå‡»æ ‡è®°ä¸ºå®Œæˆ',
                  checked: task.isCompleted,
                  child: Checkbox(
                    value: task.isCompleted,
                    onChanged: (value) => _toggleCompletion(value!),
                  ),
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }

  String _buildSemanticLabel() {
    final parts = <String>[];

    // 1. ä¼˜å…ˆçº§
    final priority = _getPriorityLabel(task.priority);
    if (priority != 'æ— ') {
      parts.add('$priorityä¼˜å…ˆçº§');
    }

    // 2. ä»»åŠ¡æ ‡é¢˜
    parts.add('ä»»åŠ¡');
    parts.add(task.title);

    // 3. å®ŒæˆçŠ¶æ€
    if (task.isCompleted) {
      parts.add('å·²å®Œæˆ');
    }

    // 4. æˆªæ­¢æ—¶é—´ (å¦‚æœæœ‰)
    if (task.dueAt != null) {
      parts.add(_formatDueAtForScreenReader(task.dueAt!));
    }

    // 5. å­ä»»åŠ¡è¿›åº¦ (å¦‚æœæœ‰)
    if (task.subtasks.isNotEmpty) {
      final completed = task.subtasks.where((s) => s.isCompleted).length;
      final total = task.subtasks.length;
      parts.add('$completed/$total ä¸ªå­ä»»åŠ¡å·²å®Œæˆ');
    }

    return parts.join(', ');
  }

  String _buildSemanticHint() {
    return 'åŒå‡»ç¼–è¾‘ä»»åŠ¡, é•¿æŒ‰æ˜¾ç¤ºæ›´å¤šé€‰é¡¹';
  }

  String _getPriorityLabel(TaskPriority priority) {
    return switch (priority) {
      TaskPriority.none => 'æ— ',
      TaskPriority.low => 'ä½',
      TaskPriority.medium => 'ä¸­',
      TaskPriority.high => 'é«˜',
      TaskPriority.critical => 'ç´§æ€¥',
    };
  }

  String _formatDueAtForScreenReader(DateTime dueAt) {
    final now = DateTime.now();
    final diff = dueAt.difference(now);

    if (diff.inDays == 0) {
      if (diff.isNegative) {
        return 'å·²é€¾æœŸ ${diff.abs().inHours} å°æ—¶';
      } else {
        return 'ä»Šå¤© ${DateFormat('HH:mm').format(dueAt)} åˆ°æœŸ';
      }
    } else if (diff.inDays == 1) {
      return 'æ˜å¤©åˆ°æœŸ';
    } else if (diff.inDays > 0 && diff.inDays <= 7) {
      return '${diff.inDays} å¤©ååˆ°æœŸ';
    } else {
      return '${DateFormat('yyyyå¹´Mæœˆdæ—¥').format(dueAt)} åˆ°æœŸ';
    }
  }

  Future<void> _toggleCompletion(bool value) async {
    // é€šçŸ¥å±å¹•é˜…è¯»å™¨çŠ¶æ€å˜åŒ–
    SemanticsService.announce(
      value ? 'ä»»åŠ¡å·²å®Œæˆ' : 'ä»»åŠ¡å·²å–æ¶ˆå®Œæˆ',
      TextDirection.ltr,
    );

    // è§¦è§‰åé¦ˆ
    if (value) {
      HapticFeedbackHelper.success();
    } else {
      HapticFeedbackHelper.light();
    }

    // æ‰§è¡Œåˆ‡æ¢
    await taskService.toggleCompletion(task, isCompleted: value);
  }
}
```

**ç¬¬2æ­¥: ä¸ºç»Ÿè®¡å¡ç‰‡æ·»åŠ è¯­ä¹‰**

```dart
// Dashboard ç»Ÿè®¡å¡ç‰‡
Semantics(
  label: 'ä»Šæ—¥å®Œæˆ',
  value: '$completed / $total ä¸ªä»»åŠ¡',
  hint: 'åŒå‡»æŸ¥çœ‹ä»Šæ—¥ä»»åŠ¡',
  button: true,
  onTap: () => _showTodayTasks(),
  child: DashboardCard(...),
)

// è¿›åº¦æ¡
Semantics(
  label: 'å­ä»»åŠ¡è¿›åº¦',
  value: '${(progress * 100).toInt()}%',
  child: LinearProgressIndicator(value: progress),
)
```

**ç¬¬3æ­¥: ä¸ºç­›é€‰å™¨æ·»åŠ è¯­ä¹‰**

```dart
// å¿«é€Ÿç­›é€‰ Chip
Semantics(
  label: 'ç­›é€‰',
  value: isSelected ? 'å·²é€‰æ‹© ä»Šå¤©' : 'ä»Šå¤©',
  hint: 'åŒå‡»ç­›é€‰ä»Šå¤©çš„ä»»åŠ¡',
  button: true,
  selected: isSelected,
  onTap: () {
    // é€šçŸ¥å±å¹•é˜…è¯»å™¨
    SemanticsService.announce(
      'å·²ç­›é€‰ä»Šå¤©çš„ä»»åŠ¡',
      TextDirection.ltr,
    );
    _applyFilter();
  },
  child: FilterChip(...),
)
```

**éœ€è¦æ·»åŠ è¯­ä¹‰çš„æ‰€æœ‰ç»„ä»¶**:

- âœ… ä»»åŠ¡å¡ç‰‡ (ä¼˜å…ˆçº§ + æ ‡é¢˜ + çŠ¶æ€ + æˆªæ­¢æ—¶é—´)
- âœ… å¤é€‰æ¡† (å®Œæˆ/æœªå®Œæˆ + æç¤º)
- âœ… æ—¥æœŸæ—¶é—´ (æ ¼å¼åŒ–æœ—è¯»)
- âœ… è¿›åº¦æ¡ (ç™¾åˆ†æ¯”)
- âœ… ç­›é€‰å™¨ (å½“å‰çŠ¶æ€ + æç¤º)
- âœ… ç»Ÿè®¡å¡ç‰‡ (æ•°å€¼ + å•ä½)
- âœ… æŒ‰é’® (åŠŸèƒ½æè¿°)
- âœ… å¯¹è¯æ¡† (æ ‡é¢˜ + å†…å®¹æ‘˜è¦)

**å·¥ä½œé‡**: 12 å°æ—¶

---

#### 1.3 åŠ¨æ€å†…å®¹é€šçŸ¥ âš ï¸ P0

**ä½¿ç”¨ SemanticsService.announce é€šçŸ¥ç”¨æˆ·é‡è¦å˜åŒ–**:

```dart
// ä»»åŠ¡å®Œæˆ
await toggleCompletion();
SemanticsService.announce(
  'ä»»åŠ¡"${task.title}"å·²å®Œæˆ',
  TextDirection.ltr,
);

// ä»»åŠ¡åˆ é™¤
await deleteTask();
SemanticsService.announce(
  'å·²åˆ é™¤ä»»åŠ¡"${task.title}"',
  TextDirection.ltr,
);

// ç­›é€‰å˜æ›´
applyFilter(filter);
SemanticsService.announce(
  'å·²ç­›é€‰ ${filter.name},æ‰¾åˆ° $count ä¸ªä»»åŠ¡',
  TextDirection.ltr,
);

// é”™è¯¯å‘ç”Ÿ
try {
  await saveTask();
} catch (e) {
  SemanticsService.announce(
    'ä¿å­˜å¤±è´¥: $e',
    TextDirection.ltr,
  );
}
```

**å·¥ä½œé‡**: 3 å°æ—¶

---

### Phase 2: ç”¨æˆ·ä½“éªŒå¢å¼º (1å‘¨)

#### 2.1 å­—ä½“å¤§å°å¯è°ƒèŠ‚ âš ï¸ P1

**å®æ–½æ–¹æ¡ˆ**:

```dart
// 1. å®šä¹‰å­—ä½“ç¼©æ”¾é€‰é¡¹
enum TextScaleOption {
  system,     // è·Ÿéšç³»ç»Ÿ (æ¨è)
  small,      // 0.85x
  medium,     // 1.0x (é»˜è®¤)
  large,      // 1.15x
  extraLarge, // 1.3x
}

// 2. åœ¨ AppSettings ä¸­ä¿å­˜ç”¨æˆ·é€‰æ‹©
class AppSettings {
  final TextScaleOption textScale;
  // ...
}

// 3. åœ¨è®¾ç½®é¡µæ·»åŠ é€‰æ‹©å™¨
class TextScaleSelector extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final settings = ref.watch(appSettingsProvider);
    final currentScale = settings.valueOrNull?.textScale ?? TextScaleOption.system;

    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Text('å­—ä½“å¤§å°', style: theme.textTheme.titleMedium),
        SizedBox(height: 12),

        SegmentedButton<TextScaleOption>(
          segments: [
            ButtonSegment(
              value: TextScaleOption.system,
              label: Text('è·Ÿéšç³»ç»Ÿ'),
              icon: Icon(Icons.smartphone),
            ),
            ButtonSegment(
              value: TextScaleOption.small,
              label: Text('å°'),
            ),
            ButtonSegment(
              value: TextScaleOption.medium,
              label: Text('æ ‡å‡†'),
            ),
            ButtonSegment(
              value: TextScaleOption.large,
              label: Text('å¤§'),
            ),
            ButtonSegment(
              value: TextScaleOption.extraLarge,
              label: Text('ç‰¹å¤§'),
            ),
          ],
          selected: {currentScale},
          onSelectionChanged: (Set<TextScaleOption> selected) {
            ref.read(appSettingsProvider.notifier).updateTextScale(
              selected.first,
            );
          },
        ),

        SizedBox(height: 16),

        // é¢„è§ˆ
        Container(
          padding: EdgeInsets.all(16),
          decoration: BoxDecoration(
            color: theme.colorScheme.surfaceContainerLow,
            borderRadius: BorderRadius.circular(12),
          ),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Text(
                'é¢„è§ˆ',
                style: theme.textTheme.labelSmall,
              ),
              SizedBox(height: 8),
              Text(
                'è¿™æ˜¯æ­£æ–‡æ–‡å­—çš„é¢„è§ˆ',
                style: theme.textTheme.bodyMedium,
              ),
              Text(
                'è¿™æ˜¯æ ‡é¢˜æ–‡å­—çš„é¢„è§ˆ',
                style: theme.textTheme.titleLarge,
              ),
            ],
          ),
        ),
      ],
    );
  }
}

// 4. åœ¨ App ä¸­åº”ç”¨å­—ä½“ç¼©æ”¾
class App extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final settings = ref.watch(appSettingsProvider).valueOrNull;
    final textScale = settings?.textScale ?? TextScaleOption.system;

    return MaterialApp.router(
      builder: (context, child) {
        final mediaQueryData = MediaQuery.of(context);
        final scaleFactor = _getScaleFactor(textScale, mediaQueryData.textScaleFactor);

        return MediaQuery(
          data: mediaQueryData.copyWith(
            textScaleFactor: scaleFactor,
          ),
          child: child!,
        );
      },
      // ...
    );
  }

  double _getScaleFactor(TextScaleOption option, double systemScale) {
    return switch (option) {
      TextScaleOption.system => systemScale,
      TextScaleOption.small => 0.85,
      TextScaleOption.medium => 1.0,
      TextScaleOption.large => 1.15,
      TextScaleOption.extraLarge => 1.3,
    };
  }
}
```

**æµ‹è¯•**: ç¡®ä¿æ‰€æœ‰æ–‡å­—åœ¨ 200% ç¼©æ”¾ä¸‹ä»å¯è¯»ä¸”ä¸æº¢å‡º

**å·¥ä½œé‡**: 6 å°æ—¶

---

#### 2.2 ç„¦ç‚¹ç®¡ç†å’Œé”®ç›˜å¯¼èˆª âš ï¸ P1

**ç›®æ ‡**: æ‰€æœ‰æ“ä½œéƒ½å¯ä»¥é€šè¿‡é”®ç›˜å®Œæˆ

**å®æ–½æ–¹æ¡ˆ**:

```dart
// lib/src/core/accessibility/keyboard_shortcuts.dart

class AppShortcuts {
  // ä»»åŠ¡æ“ä½œ
  static const toggleCompletion = SingleActivator(LogicalKeyboardKey.space);
  static const editTask = SingleActivator(LogicalKeyboardKey.enter);
  static const deleteTask = SingleActivator(LogicalKeyboardKey.delete);

  // å¯¼èˆª
  static const nextTask = SingleActivator(LogicalKeyboardKey.arrowDown);
  static const previousTask = SingleActivator(LogicalKeyboardKey.arrowUp);
  static const firstTask = SingleActivator(LogicalKeyboardKey.home);
  static const lastTask = SingleActivator(LogicalKeyboardKey.end);

  // ç­›é€‰
  static const showAllTasks = SingleActivator(
    LogicalKeyboardKey.digit1,
    meta: true, // Cmd/Ctrl + 1
  );
  static const showTodayTasks = SingleActivator(
    LogicalKeyboardKey.digit2,
    meta: true,
  );

  // åˆ›å»º
  static const newTask = SingleActivator(
    LogicalKeyboardKey.keyN,
    meta: true,
  );
}

// åœ¨ä»»åŠ¡å¡ç‰‡ä¸­å®ç°
class FocusableTaskCard extends StatefulWidget {
  final Task task;

  @override
  Widget build(BuildContext context) {
    return Focus(
      onKey: (node, event) {
        if (event is RawKeyDownEvent) {
          if (event.logicalKey == LogicalKeyboardKey.space) {
            _toggleCompletion();
            return KeyEventResult.handled;
          } else if (event.logicalKey == LogicalKeyboardKey.enter) {
            _editTask();
            return KeyEventResult.handled;
          } else if (event.logicalKey == LogicalKeyboardKey.delete) {
            _deleteTask();
            return KeyEventResult.handled;
          }
        }
        return KeyEventResult.ignored;
      },
      child: FocusableActionDetector(
        onShowFocusHighlight: (hasFocus) {
          setState(() => _hasFocus = hasFocus);
        },
        onShowHoverHighlight: (hasHover) {
          setState(() => _hasHover = hasHover);
        },
        child: Container(
          decoration: BoxDecoration(
            border: Border.all(
              color: _hasFocus
                  ? theme.colorScheme.primary
                  : (_hasHover ? theme.colorScheme.outline : Colors.transparent),
              width: _hasFocus ? 2 : 1,
            ),
            borderRadius: BorderRadius.circular(20),
          ),
          child: TaskCard(task: task),
        ),
      ),
    );
  }
}

// è®¾ç½® Tab é¡ºåº
FocusTraversalGroup(
  policy: OrderedTraversalPolicy(),
  child: Column(
    children: tasks.asMap().entries.map((entry) {
      return FocusTraversalOrder(
        order: NumericFocusOrder(entry.key.toDouble()),
        child: FocusableTaskCard(task: entry.value),
      );
    }).toList(),
  ),
)
```

**å·¥ä½œé‡**: 8 å°æ—¶

---

#### 2.3 è§¦æ‘¸åŒºåŸŸå¤§å°æ£€æŸ¥ âš ï¸ P2

**WCAG è¦æ±‚**: æœ€å° 44x44 åƒç´ 

**æ£€æŸ¥å’Œä¿®å¤**:

```dart
// âŒ å¯èƒ½è¿‡å°çš„å…ƒç´ 
IconButton(
  icon: Icon(Icons.timer, size: 20),
  visualDensity: VisualDensity.compact, // å¯èƒ½å¯¼è‡´åŒºåŸŸ < 44px
)

// âœ… ç¡®ä¿æœ€å°å°ºå¯¸
IconButton(
  icon: Icon(Icons.timer, size: 20),
  constraints: BoxConstraints(
    minWidth: 44,
    minHeight: 44,
  ),
  padding: EdgeInsets.all(12),
)

// æˆ–ä½¿ç”¨åŒ…è£…å™¨
class MinTouchTarget extends StatelessWidget {
  final Widget child;

  @override
  Widget build(BuildContext context) {
    return ConstrainedBox(
      constraints: BoxConstraints(
        minWidth: 44,
        minHeight: 44,
      ),
      child: child,
    );
  }
}
```

**å·¥ä½œé‡**: 4 å°æ—¶

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### è‡ªåŠ¨åŒ–æµ‹è¯•

```dart
// test/accessibility/contrast_test.dart

void main() {
  group('Contrast Checker', () {
    test('Black on white meets AA', () {
      expect(
        ContrastChecker.meetsWCAG_AA(Colors.black, Colors.white),
        true,
      );
    });

    test('Grey on white fails AA for small text', () {
      expect(
        ContrastChecker.meetsWCAG_AA(
          Colors.grey[400]!,
          Colors.white,
        ),
        false,
      );
    });

    test('Theme colors meet AA', () {
      final theme = AppTheme.light();

      expect(
        ContrastChecker.meetsWCAG_AA(
          theme.colorScheme.onSurface,
          theme.colorScheme.surface,
        ),
        true,
      );
    });
  });
}
```

### æ‰‹åŠ¨æµ‹è¯•

#### å±å¹•é˜…è¯»å™¨æµ‹è¯•

**Android (TalkBack)**:
1. è®¾ç½® â†’ æ— éšœç¢ â†’ TalkBack â†’ å¼€å¯
2. æ»‘åŠ¨æµè§ˆä»»åŠ¡åˆ—è¡¨
3. éªŒè¯æœ—è¯»å†…å®¹æ˜¯å¦å®Œæ•´æ¸…æ™°
4. åŒå‡»æ‰§è¡Œæ“ä½œ
5. æ£€æŸ¥æ“ä½œç»“æœé€šçŸ¥

**iOS (VoiceOver)**:
1. è®¾ç½® â†’ è¾…åŠ©åŠŸèƒ½ â†’ VoiceOver â†’ å¼€å¯
2. ä½¿ç”¨è½¬å­å¯¼èˆª
3. éªŒè¯æ‰€æœ‰å…ƒç´ éƒ½å¯è®¿é—®
4. æ£€æŸ¥è‡ªå®šä¹‰æ‰‹åŠ¿

#### å­—ä½“ç¼©æ”¾æµ‹è¯•

1. ç³»ç»Ÿè®¾ç½®å­—ä½“æ”¾å¤§ 200%
2. æ£€æŸ¥æ‰€æœ‰é¡µé¢å¸ƒå±€
3. ç¡®ä¿æ–‡å­—ä¸æº¢å‡º
4. ç¡®ä¿å¯ç‚¹å‡»åŒºåŸŸä¸é‡å 

#### é”®ç›˜å¯¼èˆªæµ‹è¯•

1. è¿æ¥å¤–æ¥é”®ç›˜
2. ä½¿ç”¨ Tab é”®å¯¼èˆªæ‰€æœ‰å…ƒç´ 
3. ä½¿ç”¨ Space/Enter æ¿€æ´»
4. æµ‹è¯•æ‰€æœ‰å¿«æ·é”®

---

## ğŸ“ˆ æ”¹è¿›æ—¶é—´è¡¨

### ç¬¬1-2å‘¨: å…³é”®åˆè§„æ€§
- [ ] Day 1-2: åˆ›å»ºå¯¹æ¯”åº¦æ£€æŸ¥å·¥å…· (4h)
- [ ] Day 3-4: éªŒè¯å’Œä¿®å¤ä¸»é¢˜é…è‰² (4h)
- [ ] Day 5-8: æ·»åŠ å±å¹•é˜…è¯»å™¨æ”¯æŒ (12h)
- [ ] Day 9-10: åŠ¨æ€å†…å®¹é€šçŸ¥ (3h)

**é‡Œç¨‹ç¢‘**: å¯è®¿é—®æ€§è¯„åˆ† 6.5 â†’ 8.0

### ç¬¬3å‘¨: ç”¨æˆ·ä½“éªŒå¢å¼º
- [ ] Day 1-3: å­—ä½“å¤§å°å¯è°ƒèŠ‚ (6h)
- [ ] Day 4-5: ç„¦ç‚¹ç®¡ç†å’Œé”®ç›˜å¯¼èˆª (8h)
- [ ] Day 6: è§¦æ‘¸åŒºåŸŸæ£€æŸ¥ (4h)

**é‡Œç¨‹ç¢‘**: å¯è®¿é—®æ€§è¯„åˆ† 8.0 â†’ 9.0

---

## âœ… éªŒæ”¶æ ‡å‡†

### WCAG 2.1 AA åˆè§„æ€§æ£€æŸ¥æ¸…å•

- [ ] **1.4.3 å¯¹æ¯”åº¦ (æœ€å°)**: æ‰€æœ‰æ–‡å­—å¯¹æ¯”åº¦ â‰¥ 4.5:1
- [ ] **1.4.4 æ–‡æœ¬ç¼©æ”¾**: æ”¯æŒ 200% ç¼©æ”¾ä¸å½±å“åŠŸèƒ½
- [ ] **2.1.1 é”®ç›˜**: æ‰€æœ‰åŠŸèƒ½å¯ç”¨é”®ç›˜æ“ä½œ
- [ ] **2.4.7 ç„¦ç‚¹å¯è§**: ç„¦ç‚¹æŒ‡ç¤ºå™¨æ¸…æ™°å¯è§
- [ ] **4.1.2 åç§°ã€è§’è‰²ã€å€¼**: æ‰€æœ‰UIç»„ä»¶æœ‰æ­£ç¡®è¯­ä¹‰
- [ ] **4.1.3 çŠ¶æ€æ¶ˆæ¯**: çŠ¶æ€å˜åŒ–åŠæ—¶é€šçŸ¥ç”¨æˆ·

### å±å¹•é˜…è¯»å™¨æµ‹è¯•é€šè¿‡æ ‡å‡†

- [ ] ä»»åŠ¡ä¿¡æ¯å®Œæ•´æœ—è¯» (ä¼˜å…ˆçº§+æ ‡é¢˜+çŠ¶æ€+æ—¶é—´)
- [ ] æ“ä½œæç¤ºæ¸…æ™° (åŒå‡»ç¼–è¾‘/é•¿æŒ‰èœå•)
- [ ] çŠ¶æ€å˜åŒ–åŠæ—¶é€šçŸ¥
- [ ] å¯¼èˆªé¡ºåºåˆç†
- [ ] æ— è¯­ä¹‰ä¿¡æ¯ç¼ºå¤±
- [ ] æ— å†—ä½™æˆ–æ··ä¹±æœ—è¯»

---

**æ›´æ–°æ—¥æœŸ**: 2025-10-20
**è´Ÿè´£äºº**: å¯è®¿é—®æ€§å›¢é˜Ÿ
**å®¡æ ¸äºº**: UI/UX Lead
